<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>并发算法理论 | Tyler-yin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="并发">
    <meta name="description" content="并发算法理论内存模型Sequential Consistency model n个线程一个共享的内存memory，每一个读都是最近的写入的值；（交错，通过枚举行为得到所有可能的行为）                                                                                              image-202210051">
<meta property="og:type" content="article">
<meta property="og:title" content="并发算法理论">
<meta property="og:url" content="http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/index.html">
<meta property="og:site_name" content="Tyler-yin&#39;s blog">
<meta property="og:description" content="并发算法理论内存模型Sequential Consistency model n个线程一个共享的内存memory，每一个读都是最近的写入的值；（交错，通过枚举行为得到所有可能的行为）                                                                                              image-202210051">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005142819393.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005164501388.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005164644229.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005165526334.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005165510133.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005174019875.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005174033350.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005203506160.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005203737366.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005203811327.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005211622421.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005212456638.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005211134906.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221005213210938.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006105106575.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006112245075.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006124708667.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006130330709.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006130355006.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006152709317.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006153604699.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20221006154701915.png">
<meta property="article:published_time" content="2022-10-06T09:38:37.000Z">
<meta property="article:modified_time" content="2022-10-06T09:41:04.992Z">
<meta property="article:author" content="Tyler-yin">
<meta property="article:tag" content="并发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tyler-ytr.github.io/picture/image-20221005142819393.png">
    
        <link rel="alternate" type="application/atom+xml" title="Tyler-yin&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/Tyler.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Tyler-yin</h5>
          <a href="mailto:ytrpossible@gmail.com" title="ytrpossible@gmail.com" class="mail">ytrpossible@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Index
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Tyler-ytr/" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-address-book"></i>
                Friends
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-link"></i>
                link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">并发算法理论</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">并发算法理论</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-10-06T09:38:37.000Z" itemprop="datePublished" class="page-time">
  2022-10-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#并发算法理论"><span class="post-toc-number">1.</span> <span class="post-toc-text">并发算法理论</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#内存模型"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">内存模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sequential-Consistency-model"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">Sequential Consistency model</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#弱内存模型"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">弱内存模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设计标准"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">设计标准</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#java-memory-model的核心——happen-before-memory-model-hmm"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">java memory model的核心——happen-before memory model(hmm)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Happen-before-order"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">Happen before order</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#并发的基本操作语义"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">并发的基本操作语义</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#basic-domain"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">basic domain</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Expressions-and-commands"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">Expressions and commands</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Program"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">Program</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#描述程序含义"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">描述程序含义</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#线程子系统简述"><span class="post-toc-number">1.3.4.1.</span> <span class="post-toc-text">线程子系统简述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#存储子系统简述"><span class="post-toc-number">1.3.4.2.</span> <span class="post-toc-text">存储子系统简述</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#线程子系统"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">线程子系统</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#合成到并发程序级别"><span class="post-toc-number">1.3.5.1.</span> <span class="post-toc-text">合成到并发程序级别</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存储子系统"><span class="post-toc-number">1.3.6.</span> <span class="post-toc-text">存储子系统</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Sequential-Consistency-model-存储子系统"><span class="post-toc-number">1.3.6.1.</span> <span class="post-toc-text">Sequential Consistency model 存储子系统</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TSO-存储子系统"><span class="post-toc-number">1.3.7.</span> <span class="post-toc-text">TSO 存储子系统</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存储，线程合并起来"><span class="post-toc-number">1.3.8.</span> <span class="post-toc-text">存储，线程合并起来</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SC-model"><span class="post-toc-number">1.3.8.1.</span> <span class="post-toc-text">SC model</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#TSO-model"><span class="post-toc-number">1.3.8.2.</span> <span class="post-toc-text">TSO model</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#并发的声明式语义-Declarative-semantics-for-concurrency"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">并发的声明式语义(Declarative semantics for concurrency)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#执行图的定义"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">执行图的定义</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#程序映射到执行图"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">程序映射到执行图</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一致性谓词-consistency-predicate"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">一致性谓词(consistency predicate)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Sequential-consistency"><span class="post-toc-number">1.4.3.1.</span> <span class="post-toc-text">Sequential consistency</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Sequential-consistency-另外的定义"><span class="post-toc-number">1.4.3.2.</span> <span class="post-toc-text">Sequential consistency 另外的定义</span></a></li></ol></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-并发算法理论"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">并发算法理论</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-10-06 17:38:37" datetime="2022-10-06T09:38:37.000Z"  itemprop="datePublished">2022-10-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="并发算法理论"><a href="#并发算法理论" class="headerlink" title="并发算法理论"></a>并发算法理论</h1><h2 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h2><h3 id="Sequential-Consistency-model"><a href="#Sequential-Consistency-model" class="headerlink" title="Sequential Consistency model"></a>Sequential Consistency model</h3><p> n个线程一个共享的内存memory，每一个读都是最近的写入的值；（交错，通过枚举行为得到所有可能的行为）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221005142819393.png" alt="image-20221005142819393" title="">
                </div>
                <div class="image-caption">image-20221005142819393</div>
            </figure>
<p>SC是比较强的内存模型；比如如下例子：</p>
<table>
<thead>
<tr>
<th>Init</th>
<th>x=y=0</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>x=1</td>
<td>\</td>
<td>\</td>
<td></td>
<td>y=1</td>
</tr>
<tr>
<td>r1=y</td>
<td>\</td>
<td>\</td>
<td></td>
<td>r2=x</td>
</tr>
</tbody>
</table>
<p>在SC model不会出现r1=r2=0;但是在x86或者java会出现；</p>
<h2 id="弱内存模型"><a href="#弱内存模型" class="headerlink" title="弱内存模型"></a>弱内存模型</h2><h3 id="设计标准"><a href="#设计标准" class="headerlink" title="设计标准"></a>设计标准</h3><ol>
<li><p>DRF(data race freedom) guarantee 数据竞争保证：满足DRF的程序在弱内存模型下的行为和SC模型的行为一样；（其中怎么看待一个程序是不是DRF的指的是这个程序在SC下面是不是DRF的）</p>
<p>DRF定义：</p>
<p>当出现两个<strong>并发</strong>的<strong>冲突</strong>操作的时候会出现数据竞争：</p>
<ol>
<li>冲突：两个操作都访问一块内存区域并且至少一个是写操作</li>
<li>并发：<ol>
<li>在不同模型不一样</li>
<li>在java里面，就是两个操作没有happen-before顺序；<ol>
<li>如果是SC model；那么一个线程内部前后操作c1,c2；或者两个线程的通过锁保护的部分有happen-before关系；(也就是 $program ~order~\cup~synchronize-with$)</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>可以被实现(不能特别强)</p>
<ol>
<li>优化：支持通常的优化（编译器的优化）</li>
<li>硬件：允许正常的map到现代体系结构的compilation scheme</li>
</ol>
</li>
<li>保证内存安全和安全保证（不能特别弱）,不能出现一些凭空出现的行为</li>
</ol>
<p>弱内存模型不好设计，编译器的优化会令人惊讶。</p>
<h3 id="java-memory-model的核心——happen-before-memory-model-hmm"><a href="#java-memory-model的核心——happen-before-memory-model-hmm" class="headerlink" title="java memory model的核心——happen-before memory model(hmm)"></a>java memory model的核心——happen-before memory model(hmm)</h3><ol>
<li>相对于SC的枚举定义行为的方式，HMM使用声明式(declarative semantics)定义程序的行为（给一个行为判定是不是满足weak memory model约束）</li>
</ol>
<h4 id="Happen-before-order"><a href="#Happen-before-order" class="headerlink" title="Happen before order"></a>Happen before order</h4><ol>
<li><p>程序执行：事件集合，他们之间存在顺序(po(program order)+sw(synchronize-with)):</p>
<p><img src="/picture/image-20221005164501388.png" alt="image-20221005164501388"></p>
</li>
<li><p>happen before order:$po\cup sw$的传递闭包:</p>
<p><img src="/picture/image-20221005164644229.png" alt="image-20221005164644229"></p>
</li>
<li><p>约束，Read能看到的：</p>
<ol>
<li>在它之前happen-before最近的写</li>
<li>与他毫无happen-before的写</li>
</ol>
<p>上图中r可以看到w1也可以看到w2</p>
</li>
<li><p>判定程序行为的方式：</p>
<ol>
<li><p>画执行图</p>
<p><img src="/picture/image-20221005165526334.png" alt="image-20221005165526334"></p>
</li>
<li><p>给一个行为，判断合不合理（先猜然后解读，形成环）</p>
<p><img src="/picture/image-20221005165510133.png" alt="image-20221005165510133"></p>
<p>存在good speculation和bad speculation;HMM可以产生out-of-thin-air read(凭空产生的读)</p>
</li>
<li><p>在HMM之上为了区分good/bad speculation 加入了很多复杂的内容形成了JMM</p>
</li>
</ol>
</li>
</ol>
<h2 id="并发的基本操作语义"><a href="#并发的基本操作语义" class="headerlink" title="并发的基本操作语义"></a>并发的基本操作语义</h2><h3 id="basic-domain"><a href="#basic-domain" class="headerlink" title="basic domain"></a>basic domain</h3><ol>
<li>$r\in Reg$ 表示寄存器，本地变量</li>
<li>$x\in Loc$ 共享的，地址</li>
<li>$v\in Val$ 值，包含0</li>
<li>$i\in Tid={1,..,N}$ 线程标识</li>
</ol>
<h3 id="Expressions-and-commands"><a href="#Expressions-and-commands" class="headerlink" title="Expressions and commands"></a>Expressions and commands</h3><ol>
<li>$e::=r|v|e+e|e-e|e*e|e/e$</li>
<li>$c::=skip|if~e~then~c~else~c|while~e~do~c|c;c|r:=e|r:=x|x:=e|r:=FAA(x,e)|r:=CAS(x,e,e)|fence $</li>
<li>FAA(x,e): fetch and add:读取x里面的值，存到局部变量r里面，然后加上e，这个是原子发生的；</li>
<li>CAS(x,e,e):Compare-and-Swap:比较memory里面的东西是否和前面一个e一样，如果一样就设置为新的值(后面的e)，如果不一样就什么都不做；这也是原子操作；返回值表示是否成功(成功r为1否则为0)</li>
<li>fence: SC下啥都不做；weak memory model里面x=1;fence;y=x;fence会保证x一定已经写入了memory；</li>
</ol>
<h3 id="Program"><a href="#Program" class="headerlink" title="Program"></a>Program</h3><p>$P:Tid\rightarrow Cmd,written ~as~P=c_1||…||c_N$</p>
<h3 id="描述程序含义"><a href="#描述程序含义" class="headerlink" title="描述程序含义"></a>描述程序含义</h3><p>$P,S,M\Rightarrow P’,S’,M‘$</p>
<p>S表示线程的寄存器集合，M表示共享内存，P表示程序；</p>
<p>初始状态，程序在状态上执行i:l步，转换成另外一种状态；</p>
<p>上述可以分为两个子系统，线程子系统，存储子系统；另外还需要把这两个子系统合起来</p>
<h4 id="线程子系统简述"><a href="#线程子系统简述" class="headerlink" title="线程子系统简述"></a>线程子系统简述</h4><ol>
<li>线程代码c， 自己的寄存器是s:$c,s\stackrel{l}{\longrightarrow}c’,s’$</li>
<li>顺序程序</li>
<li>提升到程序步骤:$P,S\stackrel{i:l}{\longrightarrow}P’,S’$</li>
</ol>
<h4 id="存储子系统简述"><a href="#存储子系统简述" class="headerlink" title="存储子系统简述"></a>存储子系统简述</h4><ol>
<li>描述内存访问以及fence</li>
<li>$M\stackrel{i:l}{\longrightarrow}M’$</li>
</ol>
<h3 id="线程子系统"><a href="#线程子系统" class="headerlink" title="线程子系统"></a>线程子系统</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221005174019875.png" alt="image-20221005174019875" title="">
                </div>
                <div class="image-caption">image-20221005174019875</div>
            </figure>
<p>横线上是前提，下面是结论；如果不需要前提直接可以走上面就没有；$\epsilon$  表示空指令; </p>
<p><img src="/picture/image-20221005174033350.png" alt="image-20221005174033350"></p>
<p>U(x,v,v+s(e))表示update，既可以读memory也可以写memory；</p>
<h4 id="合成到并发程序级别"><a href="#合成到并发程序级别" class="headerlink" title="合成到并发程序级别"></a>合成到并发程序级别</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221005203506160.png" alt="image-20221005203506160" title="">
                </div>
                <div class="image-caption">image-20221005203506160</div>
            </figure>
<p>这里l表示和memory model的交互；i是线程的id；</p>
<p>Transition表示只有线程i相关的部分(程序和register)发生了变化，表示：每次都是任取一个线程i走一步，然后代码就是线程i执行之后的结果，其他线程的部分不变</p>
<h3 id="存储子系统"><a href="#存储子系统" class="headerlink" title="存储子系统"></a>存储子系统</h3><h4 id="Sequential-Consistency-model-存储子系统"><a href="#Sequential-Consistency-model-存储子系统" class="headerlink" title="Sequential Consistency model 存储子系统"></a>Sequential Consistency model 存储子系统</h4><ol>
<li><p>SC model：</p>
<p><img src="/picture/image-20221005203737366.png" alt="image-20221005203737366"></p>
<p><img src="/picture/image-20221005203811327.png" alt="image-20221005203811327"></p>
</li>
</ol>
<h3 id="TSO-存储子系统"><a href="#TSO-存储子系统" class="headerlink" title="TSO 存储子系统"></a>TSO 存储子系统</h3><ol>
<li><p>TSO存储模型，用于x86：</p>
<p>每一个线程都有一个buffer，写的时候不会直接写而是写到buffer里面；然后不定时的把清空buffer，把里面的值写入到memory里面；读的时候先看buffer，有的话直接读取buffer否则读memory；</p>
<p>存在情况，线程A写到了自己的buffer里面，线程B读的是memory里面的值；</p>
<p><img src="/picture/image-20221005211622421.png" alt="image-20221005211622421"></p>
<p>相对于上面只有一个接口l，现在下面这部分需要考虑buffer和memory这块接口以及把他们合起来的方法； </p>
</li>
<li><p>TSO存储子系统的状态：</p>
<ol>
<li>A memory M:$Loc\rightarrow Val$  通过Loc可以获得值</li>
<li>A function B: $Tid\rightarrow (Loc,Val)^*$ 每一个线程都有自己的buffer，buffer里面是一串写操作(通过(Loc，Val)对表示)；</li>
</ol>
<p>初始状态：$&lt;M_0,B_0&gt;$</p>
<pre><code>1. $M_0=\lambda x.0$ 所有位置都是0
2. $B_0=\lambda i.\epsilon$ 所有buffer都是空的
</code></pre></li>
<li><p>TSO存储子系统的状态转化：</p>
<p><img src="/picture/image-20221005212456638.png" alt="image-20221005212456638"></p>
<p>WRITE表示在原来的基础上增加一个$&lt;x,v&gt;$操作；</p>
<p>PROPAGATE表示把buffer里面的内容写入memory；buffer里面越往右越旧，所以先写右边的内容；</p>
<p>READ操作表示的是buffer里面有就读buffer否则就读memory，并且M,B不变；</p>
<p>RMW read modify write(指FAA,CAS这类指令)要求buffer为空，并且会对memory做更新；</p>
<p>FENCE 这个操作要求当前线程的buffer是空的；</p>
</li>
<li><p>TSO模型的例子:</p>
<p>| 例子 | store | buffering |<br>| —- | —– | ——— |<br>| x=1  | ||  | y=1       |<br>| r1=y | ||  | r2=x      |</p>
<p>r1=r2=1?</p>
<p>TSO模型可以（两边都读的旧值），SC模型不行</p>
</li>
</ol>
<h3 id="存储，线程合并起来"><a href="#存储，线程合并起来" class="headerlink" title="存储，线程合并起来"></a>存储，线程合并起来</h3><h4 id="SC-model"><a href="#SC-model" class="headerlink" title="SC model"></a>SC model</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221005211134906.png" alt="image-20221005211134906" title="">
                </div>
                <div class="image-caption">image-20221005211134906</div>
            </figure>
<p>初始的执行若干步($\Rightarrow *$)能够产生O说明这个O是被允许的；</p>
<h4 id="TSO-model"><a href="#TSO-model" class="headerlink" title="TSO model"></a>TSO model</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221005213210938.png" alt="image-20221005213210938" title="">
                </div>
                <div class="image-caption">image-20221005213210938</div>
            </figure>
<h2 id="并发的声明式语义-Declarative-semantics-for-concurrency"><a href="#并发的声明式语义-Declarative-semantics-for-concurrency" class="headerlink" title="并发的声明式语义(Declarative semantics for concurrency)"></a>并发的声明式语义(Declarative semantics for concurrency)</h2><ol>
<li><p>总体思想：不去想程序怎么执行（操作语义这么整），而是产生一系列程序有可能执行的图，然后通过规则判定这些图上哪一些能够被model解释</p>
</li>
<li><p>具体而言：</p>
<ol>
<li>Define the notion of a program <strong>execution</strong> (generalization of an execution trace)</li>
<li>Map a program to a set of executions (与程序有关)</li>
<li>Define a <strong>consistency</strong> predicate on executions (定义公理，比如happen-before等约束)</li>
<li>Semantics = set of consistent executions of a program (上述满足约束的所有程序)</li>
</ol>
</li>
<li><p>例子：</p>
<p><img src="/picture/image-20221006105106575.png" alt="image-20221006105106575"></p>
<ol>
<li>例子中有事件： Reads, Writes, Updates, Fences</li>
<li>有两种关系：<strong>程序执行顺序</strong>(Program order,po;或者“sequenced-before”, sb)，黑色实线; <strong>Reads-from 顺序</strong>, rf，绿色虚线</li>
</ol>
</li>
</ol>
<h3 id="执行图的定义"><a href="#执行图的定义" class="headerlink" title="执行图的定义"></a>执行图的定义</h3><ol>
<li><p>Label：有以下格式：</p>
<p>$R~x~v_r<del>W~x~v_w</del> U(x~v_r~ v_w) ~~F$</p>
<p>其中$x \in Loc$ and $v_r , v_w \in Val$.</p>
</li>
<li><p>Event：是一个元组$&lt;id, i, l&gt;$:</p>
<ol>
<li>$id\in N$表示事件标识符</li>
<li>$i \in Tid \cup {0}$ 是线程标识符</li>
<li>l是一个label</li>
</ol>
</li>
<li><p>执行图(execution graph)：是一个元组$&lt;E, po, rf&gt;$：</p>
<ol>
<li><p>E是events的有限集合</p>
</li>
<li><p>po (“program order”) 是 E 上的偏序关系</p>
</li>
<li><p>rf (“reads-from”) 是 E 上的二元关系：</p>
<p>For every $&lt;w, r&gt;\in rf$:</p>
<ol>
<li>$typ(w) \in {W, U}$ w操作要么是写要么是更新(U)</li>
<li>$typ(r) \in {R, U}$ r操作要么是读要么是更新</li>
<li>$loc(w) = loc(r)$ 读写的位置一样</li>
<li>$val_w(w) = val_r(r)$ 读写的值一样</li>
</ol>
<p>$rf^{ −1}$ is a function,that is: if $&lt;w_1, r&gt;$, $&lt;w_2, r&gt;$,then $w_1 = w_2$ ；表示读只能读一个写</p>
</li>
</ol>
</li>
<li><p>其他一些标记：</p>
<p><img src="/picture/image-20221006112245075.png" alt="image-20221006112245075"></p>
</li>
</ol>
<h3 id="程序映射到执行图"><a href="#程序映射到执行图" class="headerlink" title="程序映射到执行图"></a>程序映射到执行图</h3><ol>
<li><p>例子，与程序有关的图：</p>
<p><img src="/picture/image-20221006124708667.png" alt="image-20221006124708667"></p>
</li>
<li><p>线程子系统将一个<strong>顺序(sequential)</strong>执行图与每个命令关联起来。通过连接组成线程的顺序执行图可以得到程序的执行；</p>
<p>如果满足以下性质，一个图是<strong>sequential</strong>的（也就是与一个线程有关的执行图的性质）：</p>
<ol>
<li>$tid(a) = 0$ for every $a \in G.E$ （与下面第四点Thread restriction有关，表示只有一个线程）</li>
<li>$G.po$ is a total order on $G.E$  （一个线程中的事件一定是有序的）</li>
<li>$G.rf = \empty$</li>
</ol>
</li>
<li><p>命令的执行图的定义：</p>
<p><img src="/picture/image-20221006130330709.png" alt="image-20221006130330709"></p>
<p>与内存有交互的命令会产生执行图的变化</p>
<p><img src="/picture/image-20221006130355006.png" alt="image-20221006130355006"></p>
</li>
<li><p>Thread restriction：</p>
<p>给定线程号$i\in Tid$，以及一个执行图G，$G^i$表示把G的事件限制成只有与线程i相关的事件:${a\in G.E|tid(a)=i}$，并且把他们的线程标识都改成0，丢弃所有rf边；</p>
</li>
<li><p>Execution graph of a program:</p>
<p>$G$ is an execution graph of a program $P $ (with an outcome $O)$ if $G_i$ is an execution of $P(i) $ (with final store O(i)) for every<br>$i \in Tid$.</p>
</li>
</ol>
<h3 id="一致性谓词-consistency-predicate"><a href="#一致性谓词-consistency-predicate" class="headerlink" title="一致性谓词(consistency predicate)"></a>一致性谓词(<strong>consistency</strong> predicate)</h3><ol>
<li><p>假设X是执行图上的一些一致性谓词，那么程序P在X下<strong>允许</strong>出现的结果O，定义为如果存在一个执行图G满足：</p>
<ol>
<li>G is an execution graph of P with outcome O. G是P的执行图能产生O</li>
<li>G is X-consistent. G满足X-一致性</li>
</ol>
<p>或者，“catch-fire” semantics定义：(对应于C/C++的undefined behavior，此时任何的O都可以产生)</p>
<p>存在一个执行图G满足：</p>
<ol>
<li>G is an execution graph of P. G是P的执行图</li>
<li>G is X-consistent. G满足X-一致性</li>
<li>G is “bad”.</li>
</ol>
</li>
<li><p>Completeness<span id="Completeness">定义</span>：</p>
<p>一个执行图G成为completeness，如果codom(G.rf) = G.R使得<strong>每一个</strong>read都能从<strong>一些</strong>write read from</p>
<p>也就是图上所有的read都通过rf边连接到write</p>
</li>
</ol>
<h4 id="Sequential-consistency"><a href="#Sequential-consistency" class="headerlink" title="Sequential consistency"></a>Sequential consistency</h4><p>任何执行的结果都与所有处理器的操作按照程序指定的顺序按某种顺序执行是一样的。</p>
<ol>
<li><p>SC-consistent 定义：假设<strong>sc</strong>是G,E上面的全序；如果下列情况满足，则称G是关于<strong>sc</strong> SC -consistent的：</p>
<ol>
<li>If $&lt;a, b&gt; \in G.po$ then $&lt;a, b&gt;\in sc$. (program order 里的都满足sc)</li>
<li>If $&lt;a, b&gt;  G.rf$ then $&lt;a, b&gt; \in sc $ and there does not exist $c \in G.W_{loc}(b)$ such that $&lt;a, c&gt; \in sc$ and $&lt;c, b&gt; \in sc$.  (不同线程之间读应该读上一次写，中间有write是不可能的)</li>
</ol>
</li>
<li><p>一个执行图如果满足下列条件那么是SC-consistent的：</p>
<ol>
<li>G is <a href="#Completeness">complete</a>. </li>
<li>G is SC-consistent wrt some total order sc on G.E. (所有事件之间要有一个sc order)</li>
</ol>
</li>
<li><p>例子：</p>
<p><img src="/picture/image-20221006152709317.png" alt="image-20221006152709317"></p>
<p>forbidden部分因为sc下一定会形成一个环，此时这个不是order了，因此不允许；</p>
<p>allowed部分可以先R y 0然后W y 1，此时就可以构成全序了；</p>
</li>
</ol>
<h4 id="Sequential-consistency-另外的定义"><a href="#Sequential-consistency-另外的定义" class="headerlink" title="Sequential consistency 另外的定义"></a>Sequential consistency 另外的定义</h4><ol>
<li><p>Modification order定义:</p>
<p>$mo$ is called a modification order for an execution graph G if $mo = \cup _{x\in Loc} mo_x$ where each $mo_x$ is a total order on $ G.Wx$ .</p>
<p>mo只在这张图的write之间建立，同一个loc上的write上面有一条边，称为$mo_x$，所有$mo_x$的并形成了mo；</p>
</li>
<li><p>SC的另一种定义：</p>
<p><img src="/picture/image-20221006153604699.png" alt="image-20221006153604699"></p>
<p>所有的po,rf,mo,rb边合起来是无环的；</p>
<p>rb的定义就是rf取逆然后加上mo，比如$Wy0 \rightarrow Wy1 (mo),Wy0\rightarrow Ry0(rf)$，因此$Ry0\rightarrow Wy0(rf^{-1})$，有$Ry0\rightarrow Wy1(rb)$ </p>
<p>rb的定义去掉id是考虑到U的情况（因为U和W可以有mo关系也可以有rf关系，有可能形成自环）</p>
</li>
</ol>
<p>两种定义是等价的，证明如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20221006154701915.png" alt="image-20221006154701915" title="">
                </div>
                <div class="image-caption">image-20221006154701915</div>
            </figure>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2022-10-06T09:41:04.992Z" itemprop="dateUpdated">2022-10-06 17:41:04</time>
</span><br>


        
        Link：<a href="/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/" target="_blank" rel="external">http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/</a>
        
    </div>
    
    <footer>
        <a href="http://Tyler-ytr.github.io">
            <img src="/img/Tyler.png" alt="Tyler-yin">
            Tyler-yin
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&title=《并发算法理论》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&title=《并发算法理论》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《并发算法理论》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2022/04/23/RDMA-learning4/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">RDMA-learning4</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "NoLhoWnmbSW89zV4zc04RPwx-gzGzoHsz",
            appKey: "SSdRGaHcdjoKc7cJJpOlJIqJ",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Tyler-yin &copy; 2015 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&title=《并发算法理论》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&title=《并发算法理论》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《并发算法理论》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2022/10/06/%E5%B9%B6%E5%8F%91%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADL0lEQVR42u3awW4iQQwE0P3/n2alPa2UQKrsQco0b05RgJl+zcHY1X/+xNfj3/X61f/f8/U/+d2e3fnrp14/5YILGxsb+ybsx8vr9UKTBz/bjmRrkleT+39zH2xsbOzj2PlyE0BSbC5Y+pN1RiUTGxsb+yPZe3DStCStxeu1YWNjY2Pn1GTcs594Jc/CxsbGxt6UmTYeSJbbbvEbZ2nY2NjYv57dBr2/+e835tvY2NjYv5L9KK/2WM8+4s2PChUKbGxs7IPYyXL3zcPmEE87SCrCBmxsbOwj2LNykgyY8kUnx3o2gfQ3n8XGxsY+iD0LevNytflPEiFvDgZhY2Njn8TeL6JtG9pB1f5TRfqBjY2NfSt2u6C2IdlsQVvGivdjY2NjH8duy1L7sGSSMyuK+XAqehkbGxv7huy2LZmFrMl9ZmWpfQ82Njb2qezkIM7sAM3sKE8y4p+1Ok9TEWxsbOwj2JsRT1uE3jHMqr8SbGxs7I9hb0ZIsxHVtWXv6QqxsbGxj2O3I/v88Vch23tGBQwbGxv75uz8J35bMPII9hFcbcpR5NvY2NjYN2dfVahm7UG76ftg+IfvHxsbG/u27NlP/00AnDcPSd2ZFTlsbGzsT2C3gH0DszlMWTdI2NjY2Aex21B2tqD9s9qwoSiH2NjY2EewZzdNAG0Bazdo1ZZgY2Nj35ydl5bNiCcvTrMvoB1vYWNjY5/Ezn/0t63FJhJuo4Jkm7CxsbHPZl/bBsyO3WzGWO8oxtjY2Nh3Yc9K1P6QzaxRaTf96avY2NjYH8POr83hnrzUzQ7rYGNjY5/N3jygbWCuGj/lgcEPW4mNjY19BHtWqGaHZtpIOG8w2sAAGxsb+zz2LBCdtSLtWOraARY2Njb2qezZ8Gg2QmrBbUG94IwSNjY29q3Y+TWLAfIQd3N8Jw8V6i3AxsbGvgk7LxLJ0q89rLOKcl9vCjY2NvZx7P3IaTbub8OAq8JmbGxs7M9kt1FrfihnWITi4z6rAoaNjY19KHsTAOftzaY5GebA2NjY2Ldlb8LU2Va2BSkpmUnAgI2NjX0eexP0Jj/926XPhkRtyIGNjY19BPsvGzK1qVMDKPwAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '＞﹏＜';
            clearTimeout(titleTime);
        } else {
            document.title = '~\(≧▽≦)/~';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>


</body>
</html>
