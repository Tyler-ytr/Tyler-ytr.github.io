<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>mininetlab 学习 | Tyler-yin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="计算机网络,实验基础,mininet">
    <meta name="description" content="Mininet 学习来自https:&#x2F;&#x2F;www.51openlab.com&#x2F;college&#x2F; 的教程，以下是学习总结 Mininet 简介Mininet 基于Linux Container这一个内核虚拟化技术开发，利用linux的network namespace机制在一台电脑上创建多台虚拟主机，此外，Mininet建立的网络拓扑的交换节点可以是Open vSwitch、Linux Bridge等">
<meta property="og:type" content="article">
<meta property="og:title" content="mininetlab 学习">
<meta property="og:url" content="http://tyler-ytr.github.io/2021/09/03/mininetlab/index.html">
<meta property="og:site_name" content="Tyler-yin&#39;s blog">
<meta property="og:description" content="Mininet 学习来自https:&#x2F;&#x2F;www.51openlab.com&#x2F;college&#x2F; 的教程，以下是学习总结 Mininet 简介Mininet 基于Linux Container这一个内核虚拟化技术开发，利用linux的network namespace机制在一台电脑上创建多台虚拟主机，此外，Mininet建立的网络拓扑的交换节点可以是Open vSwitch、Linux Bridge等">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903160253663.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903162108693.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903174617790.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903174730214.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903175036157.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903175436545.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903175538940.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180059575.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180311795.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180550232.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180606359.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180633749.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180728737.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903180824459.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210903221343833.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210906210457031.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210906210631094.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210906211022175.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907023743542.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907025832428.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907025905095.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907030627886.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907030845798.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907030928420.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907030936961.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907215209183.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907221043663.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907220635571.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907220651767.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907220705100.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907220743581.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907220846860.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907221233085.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907221616586.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210907221750866.png">
<meta property="article:published_time" content="2021-09-03T07:55:16.000Z">
<meta property="article:modified_time" content="2021-09-11T10:00:51.121Z">
<meta property="article:author" content="Tyler-yin">
<meta property="article:tag" content="计算机网络">
<meta property="article:tag" content="实验基础">
<meta property="article:tag" content="mininet">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tyler-ytr.github.io/picture/image-20210903160253663.png">
    
        <link rel="alternate" type="application/atom+xml" title="Tyler-yin&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/Tyler.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Tyler-yin</h5>
          <a href="mailto:ytrpossible@gmail.com" title="ytrpossible@gmail.com" class="mail">ytrpossible@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Index
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Tyler-ytr/" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-address-book"></i>
                Friends
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-link"></i>
                link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">mininetlab 学习</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">mininetlab 学习</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-09-03T07:55:16.000Z" itemprop="datePublished" class="page-time">
  2021-09-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/">个人总结</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mininet-学习"><span class="post-toc-number">1.</span> <span class="post-toc-text">Mininet 学习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet-简介"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Mininet 简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Mininet-安装"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">Mininet 安装</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet-拓扑构建与命令使用"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Mininet 拓扑构建与命令使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实际构建拓扑"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">实际构建拓扑</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#内部交互命令"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">内部交互命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#可视化构建"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">可视化构建</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet-调用API扩展自定义拓扑"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Mininet 调用API扩展自定义拓扑</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet-流表应用实战1——手动添加流表"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Mininet 流表应用实战1——手动添加流表</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet流表应用实战——控制器下发流表协议分析"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">Mininet流表应用实战——控制器下发流表协议分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mininet-多数据中心网络拓扑流量带宽实验"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">Mininet 多数据中心网络拓扑流量带宽实验</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写网络带宽测试程序"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">编写网络带宽测试程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构建多数据中心拓扑"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">构建多数据中心拓扑</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-mininetlab"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">mininetlab 学习</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-09-03 15:55:16" datetime="2021-09-03T07:55:16.000Z"  itemprop="datePublished">2021-09-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/">个人总结</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Mininet-学习"><a href="#Mininet-学习" class="headerlink" title="Mininet 学习"></a>Mininet 学习</h1><p>来自<a href="https://www.51openlab.com/college/" target="_blank" rel="noopener">https://www.51openlab.com/college/</a> 的教程，以下是学习总结</p>
<h2 id="Mininet-简介"><a href="#Mininet-简介" class="headerlink" title="Mininet 简介"></a>Mininet 简介</h2><p>Mininet 基于Linux Container这一个内核虚拟化技术开发，利用linux的network namespace机制在一台电脑上创建多台虚拟主机，此外，Mininet建立的网络拓扑的交换节点可以是Open vSwitch、Linux Bridge等软件交换机，交换节点之间的链路采用Linux的veth pair (virtual Ethernet pair)机制实现，控制器可以部署在网络可达的任意地方。因此，Mininet可以定制任意灵活的SDN网络拓扑，为实验用户提供快捷可靠的实验环境。</p>
<p>Mininet架构按datapath的运行权限不同，分为kernel datapath和userspace datapath两种，其中kernel datapath把分组转发的逻辑编译进入Linux内核，效率非常高; userspace datapath把分组转发逻辑实现为一个应用程序，叫做ofdatapath,效率虽不及kernel datapath，但更为灵活，更容易重新编译。</p>
<p>Mininet的kernel datapath架构如下图所示，控制器和交换机的网络接口都在root 命名空间中，每个主机都在自己独立的命名空间里，这也就表明每个主机在自己的命名空间中都会有自己独立的虚拟网卡eth0。控制器就是一个用户进程，它会在loopback上预留的6633端口监听来自交换机安全信道的连接。每个交换机对应几个网络接口，比如sO-eth0、sO-eth1以及一个ofprotocol进程，它负责管理和维护同一控制器之间的安全信道。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20210903160253663.png" alt="image-20210903160253663" title="">
                </div>
                <div class="image-caption">image-20210903160253663</div>
            </figure>
<p>Mininet的userspace datapath架构如下图所示，与kernel datapath架构不同，网络的每个节点都拥有自己独立的namespace。因为分组转发逻辑是实现在用户空间，所以多出了一个进程叫ofdatapath。另外，Mininet除了支持kernel datapath和userspace datapath这两种架构以外，还支持OVS交换机。OVS充分利用内核的高效处理能力，它的性能和kernel datapath相差无几</p>
<h3 id="Mininet-安装"><a href="#Mininet-安装" class="headerlink" title="Mininet 安装"></a>Mininet 安装</h3><ol>
<li><p>下载github源码然后编译安装，</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"> git clone http:&#x2F;&#x2F;github.com&#x2F;mininet&#x2F;mininet.git</span><br></pre></td></tr></table></figure>
<p> 其中./install.sh是安装的命令，格式如下:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;install.sh [options]</span><br></pre></td></tr></table></figure>
<p> options如下</p>
</li>
</ol>
<ul>
<li>-a :  完整安装，默认在home目录下，包括 Mininet VM,以及Open vSwich的依赖关系，OpenFlow, Wireshark分离器以及POX<ul>
<li>-nfv 安装mininet核心文件及其依赖，OpenFlow 和 Open vSwitch</li>
<li>-s mydir: 可以把源代码建立到一个特定的目录中</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>查看mininet版本</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd mininet</span><br><span class="line">cat INSTALL|more</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd util</span><br><span class="line">.&#x2F;install.sh -a</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试基本功能</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn --test pingall</span><br></pre></td></tr></table></figure>
<p> <img src="/picture/image-20210903162108693.png" alt="image-20210903162108693"></p>
</li>
<li><p>查看安装好的mininet版本:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn --version</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Mininet-拓扑构建与命令使用"><a href="#Mininet-拓扑构建与命令使用" class="headerlink" title="Mininet 拓扑构建与命令使用"></a>Mininet 拓扑构建与命令使用</h2><ol>
<li><p>MiniEdit:</p>
<p>这个可以可视化的在界面编辑任意拓扑，然后生成python自定义拓扑脚本，Mininetnet2.20+内置，在mininet/examples里面提供mininetedit.py脚本；</p>
</li>
<li><p>Mininet参数</p>
<p>topo： 用于指定网络拓扑，Mininet支持minimal,singel,linear 和tree 三种</p>
<ul>
<li>minimal: 创建一个交换机和两个主机相连的简单拓扑。默认无—topo参数的情况下就是这样。其内部实现就是调用了single,2对应的函数。</li>
<li>single,n:设置一个交换机和n个主机相连的拓扑。</li>
<li>linear,n:创建n个交换机，每个交换机只连接一个主机，并且所有交换机成线型排列。</li>
<li>tree,depth=n,fanout=m:创建深度为n，每层树枝为m的树型拓扑。因此形成的拓扑的交换机个数为(mn-1) /(m-1)，主机个数为mn。</li>
<li>–custom:在上述已有拓扑的基础上，Mininet支持自定义的拓扑，使用一个简单的Python API即可。–custom需和–topo一起使用，如mn –custom file.py –topo mytopo。</li>
</ul>
</li>
<li><p>内部交互命令:</p>
<p>| 参数                               | 作用 |<br>| ———————————- | —- |<br>| -h                                 | show this help message and exit     |<br>| –switch=SWITCH                    |   [kernel user ovsk]   |<br>| –host=HOST                        |   [process]   |<br>| –controller=CONTROLLER            | [nox_dump none ref remote nox_pysw]     |<br>| –topo=TOPO                        | [tree reversed single linear minimal],arg1,arg2,…argN |<br>| -c,–clean                         | clean and exit |<br>| –custom=CUSTOM                    | read custom topo and node params from .py file |<br>| –test=TEST                        | [cli build pingall pingpair iperf all iperfudp none] |<br>| -x,–xterms                        | spawn xterms for each node |<br>| –mac                              | set MACs equal to DPIDs |<br>| –arp                              | set all-pairs ARP entries |<br>| -v VEIBOSITY,–verbosity=VEIBOSITY | [info warning critical error debug output] |<br>| –ip=IP                            | [ip address as a dotted decimal string for aremote controller] |<br>| –port=PORT                        | [port integer for a listening remote controller] |<br>| –innamespace                      | sw and ctrl in namespace |<br>| –listenport=LISTENPORT            | [base port for passive switch listening controller] |<br>| –nolistenport                     | don’t use passive listening port |<br>| –pre=PRE                          | [CLI script to run before tests] |<br>| –post=POST                        | [CLI script to run after tests] |</p>
</li>
<li><p>Mininet常用命令总结：</p>
<p>|命令|作用|<br>|—-|—-|<br>|help|默认列出所有命令文档，后面加命令名将介绍该命令用法 dump打印节点信息|<br>|gterm|给定节点上开启gnome-terminal 注：可能导致mn崩溃|<br>|xterm|给定节点上开启xterm|<br>|intfs|列出所有的网络接口|<br>|iperf|两个节点之间进行简单的iPerf TCP测试|<br>|iperfudp|两个节点之间用制定带宽UDP进行测试|<br>|net|显示网络链接情况|<br>|noecho|运行交互式窗口，关闭回应（echoing）|<br>|pingpair|在前两个主机之间互Ping测试|<br>|source|从外部文件中读入命令|<br>|dpctl|在所有交换机上用dptcl执行相关命令，本地为tcp 127.0.0.1:6634|<br>|link|禁用或启用两个节点之间的链路|<br>|nodes|列出所有的节点信息|<br>|pingall|所有主机节点之间互Ping|<br>|py|执行Python表达式|<br>|sh|运行外部shell命令|<br>|quit/exit|退出|</p>
</li>
</ol>
<h3 id="实际构建拓扑"><a href="#实际构建拓扑" class="headerlink" title="实际构建拓扑"></a>实际构建拓扑</h3><ol>
<li><p>构建single拓扑:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --topo&#x3D;single,3</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210903174617790.png" alt="image-20210903174617790"></p>
<p><code>exit</code>退出</p>
<p>single拓扑中整个网络拓扑中交换机有且仅有一个，交换机下面可以挂一个或者多个主机；本例会创建一个交换机，3个主机，3个主机挂在一个交换机下面</p>
</li>
<li><p>构建linear拓扑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --topo&#x3D;linear,3</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210903174730214.png" alt="image-20210903174730214"></p>
<p>线性拓扑中交换机连接呈线性排列，每一个交换机连接的主机数目只有一个，本例创建了3个交换机，3个主机，3个主机挂在各自交换机下面并且交换机之间互相连接</p>
</li>
<li><p>构建tree拓扑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --topo&#x3D;tree,depth&#x3D;2,fanout&#x3D;2</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210903175036157.png" alt="image-20210903175036157"></p>
<p>创建了一个数，s1为根，下面是s2,s3,然后s2,s3各自挂两个主机；depth表示交换机深度，fanout表示每一层的节点数量；</p>
</li>
<li><p>创建自定义拓扑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;openlab&#x2F;openlab&#x2F;mininet&#x2F;custom</span><br><span class="line">sudo mn --custom topo-2sw-2host.py --topo mytopo</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210903175436545.png" alt="image-20210903175436545"></p>
<p>python 脚本如下:</p>
<p><img src="/picture/image-20210903175538940.png" alt="image-20210903175538940"></p>
</li>
</ol>
<h3 id="内部交互命令"><a href="#内部交互命令" class="headerlink" title="内部交互命令"></a>内部交互命令</h3><ol>
<li>使用net显示连接信息</li>
<li>使用nodes查看节点信息</li>
<li>使用links查看连路鲁棒性信息</li>
<li>使用pingall验证所有主机间通信查看结果</li>
<li>使用xterm h1 h2进入设备可视化操作界面</li>
<li>exit退出</li>
<li>mn -c 清楚释放Mininet构建配置的交换机及主机</li>
</ol>
<h3 id="可视化构建"><a href="#可视化构建" class="headerlink" title="可视化构建"></a>可视化构建</h3><ol>
<li><p>使用MiniEdit</p>
<p>在mininet/examples下执行miniedit.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;miniedit.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>如下图，可以选择的助教有：主机，OpenFlow交换机，传统交换机，传统路由器，链路，控制器：</p>
<p><img src="/picture/image-20210903180059575.png" alt="image-20210903180059575"></p>
</li>
<li><p>Miniedit属性配置</p>
<p>在左侧设备列表中选中需要的设备，在右侧空白区域单击，设备即添加成功。设备及链路上可进行鼠标右击长按，选择Properties即可对其进行配置。在控制器上进行鼠标右击长按，选择Properties即可对控制器进行配置:</p>
<p><img src="/picture/image-20210903180311795.png" alt="image-20210903180311795"></p>
<p>然后修改了交换机，选择Porperties，配置了16位的DPID：</p>
<p><img src="/picture/image-20210903180550232.png" alt="image-20210903180550232"></p>
<p>然后修改了主机的IP地址：</p>
<p><img src="/picture/image-20210903180606359.png" alt="image-20210903180606359"></p>
<p>修改的同时miniedit.py会在窗口中显示修改的设备属性<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20210903180633749.png" alt="image-20210903180633749" title="">
                </div>
                <div class="image-caption">image-20210903180633749</div>
            </figure></p>
</li>
<li><p>全局配置</p>
<p>Miniedit左上角Edit可以剪切删除设备，对整个网络进行全局配置</p>
<p><img src="/picture/image-20210903180728737.png" alt="image-20210903180728737"></p>
</li>
<li><p>点击左下角run即可运行设置好的网络拓扑</p>
<p><img src="/picture/image-20210903180824459.png" alt="image-20210903180824459"></p>
<p>然后此时对交换机主机右击常看可以查看交换机的bridge信息以及打开host终端</p>
</li>
<li><p>Minideit保存脚本</p>
<p>File–Export Level 2 Scirpt可以保存为python脚本，默认在mininet/examples下面，用 chomod给权限之后直接运行可以直接重现</p>
<p>比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 temp.py</span><br><span class="line">sudo .&#x2F;temp.py</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Mininet-调用API扩展自定义拓扑"><a href="#Mininet-调用API扩展自定义拓扑" class="headerlink" title="Mininet 调用API扩展自定义拓扑"></a>Mininet 调用API扩展自定义拓扑</h2><ol>
<li>Mininet作为一个基于Python的网络仿真工具，可以分为两大部分:Python库和运行文件。前者对网络中元素进行抽象和实现，例如定义主机类来表示网络中的一台主机;后者则基于这些库完成模拟过程。<br>topo 类中包含构建网络的函数如：<ul>
<li>addHost(“host name”): 添加主机</li>
<li>addSwitch(“sw name”): 添加交换机</li>
<li>addLink(node,node): 添加链路</li>
<li>attach(port):添加端口</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>首先使用自定义拓扑:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --custom topo-2sw-2host.py --topo mytopo</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加主机h3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py net.addHost(‘h3’)</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加s3与主机h3之间的链路</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py net.addLink(s3,net.get(‘h3’))</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Mininet交互环境中添加端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py s3.attach(‘s3-eth3’)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Mininet交互环境中对主机进行配置IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py net.get(‘h3’).cmd(‘ifconfig h3-eth0 10.3’)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看节点信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dump</span><br><span class="line">nodes</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210903221343833.png" alt="image-20210903221343833"></p>
</li>
<li><p>验证连通性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h1 ping h3</span><br><span class="line">pingall</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Mininet-流表应用实战1——手动添加流表"><a href="#Mininet-流表应用实战1——手动添加流表" class="headerlink" title="Mininet 流表应用实战1——手动添加流表"></a>Mininet 流表应用实战1——手动添加流表</h2><ol>
<li><p>自定义拓扑脚本文件exper1.py，脚本代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> mininet.topo <span class="keyword">import</span> Topo</span><br><span class="line"><span class="keyword">from</span> mininet.net <span class="keyword">import</span> Mininet</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> RemoteController</span><br><span class="line"><span class="keyword">from</span> mininet.link <span class="keyword">import</span> TCLink</span><br><span class="line"><span class="keyword">from</span> mininet.util <span class="keyword">import</span> dumpNodeConnections</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTopo</span><span class="params">( Topo )</span>:</span></span><br><span class="line">    <span class="string">"Simple topology example."</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">( self )</span>:</span></span><br><span class="line">        <span class="string">"Create custom topo."</span></span><br><span class="line">        <span class="comment"># Initialize topology</span></span><br><span class="line">        Topo.__init__( self )</span><br><span class="line">        <span class="comment"># Add hosts and switches</span></span><br><span class="line">        Host1 = self.addHost(h1)</span><br><span class="line">        Host2 = self.addHost(h2)</span><br><span class="line">        Host3 = self.addHost(h3)</span><br><span class="line">        Switch1 = self.addSwitch(s1)</span><br><span class="line">        Switch2 = self.addSwitch(s2)</span><br><span class="line">        <span class="comment"># Add links</span></span><br><span class="line">        self.addLink( Host1, Switch1 )</span><br><span class="line">        self.addLink( Host2, Switch1 )</span><br><span class="line">        self.addLink( Host3, Switch2 )</span><br><span class="line">        self.addLink( Switch1, Switch2 )</span><br><span class="line">topos = &#123;mytopo: ( <span class="keyword">lambda</span>: MyTopo() ) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行脚本并且远程指定一个不存在的控制器，使交换机不受控制器控制；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --custom exper1.py --topo mytopo --controller&#x3D;remote,ip&#x3D;127.0.0.1,port&#x3D;6653</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210906210457031.png" alt="image-20210906210457031"></p>
</li>
<li><p>使用如下命令打开可视化终端:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xterm h1 h2 h3</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210906210631094.png" alt="image-20210906210631094"></p>
</li>
<li><p>使用如下命令<code>dpctl dump-flows</code>查看交换机当前的flow table信息。</p>
<p><img src="/picture/image-20210906211022175.png" alt="image-20210906211022175"></p>
<p>可以看到交换机s1 s2中没有流表</p>
</li>
<li><p>h2中使用<code>tcp dump -n -i h2-eth0</code>抓取网卡h2-eth0上的数据包</p>
<p>h3中使用<code>tcp dump -n -i h3-eth0</code>抓取网卡h2-eth0上的数据包</p>
</li>
<li><p>在主机h1中执行如下命令分别ping主机h2和h3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ping -c 3 10.0.0.2</span><br><span class="line"># ping -c 3 10.0.0.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>在主机h2和h3上查看tcpdump抓包结果。</p>
<p><img src="/picture/image-20210907023743542.png" alt="image-20210907023743542"></p>
<p>发现主机h1ping h2和h3都失败了，主机h2和h3么有收到任何ICMP ecjp reqiest packet。原理解析：ping操作时，由于拓扑里没有SDN控制器，也没有用dptcl给OpenFlow交换机添加任何flow entry,所以交换机不会做转发决定，并直接丢弃h1到h2及h1到h3的ping包。</p>
</li>
<li><p>添加流表</p>
<p>执行如下命令添加交换机端口流表使主机h1和h2通信。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; dpctl add-flow in_port&#x3D;1,actions&#x3D;output:2</span><br><span class="line">mininet&gt; dpctl add-flow in_port&#x3D;2,actions&#x3D;output:1</span><br></pre></td></tr></table></figure>
<p>然后使用dpctl dump-flows查看流表，发现添加成功:</p>
<p><img src="/picture/image-20210907025832428.png" alt="image-20210907025832428"></p>
</li>
<li><p>再次 ping,发现h2可以ping通,h3不可以:</p>
<p><img src="/picture/image-20210907025905095.png" alt="image-20210907025905095"></p>
<p>原理解析：用dpctl对交换机添加flow，让交换机从s1-eth1这个端口接收到的所有traffic都从s1-eth2这个端口发出去。用dpctl给交换机添加双向流表，因为ping包除了echo request还有echo reply。所以还需要用dpctl对交换机添加flow，让交换机从s1-eth2这个端口接收到的所有traffic都从s1-eth1这个端口发出去。添加这两条flow后，h1能够ping通h2，但是并没有为h1和h3之间添加对应的端口流表，所以h1与h3不通。</p>
</li>
<li><p>添加协议流表使h1/h2通信:</p>
<p>执行如下命令删除之前通过端口添加的流表并且查看，确保交换机流表为空:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpctl del-flows</span><br><span class="line">dpctl dump-flows</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行如下命令添加两条traffic类型为IPV4协议相关的flow entry并且查看下发的流表:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dpctl add-flow dl_type&#x3D;0x0800,nw_dst&#x3D;10.0.0.2,actions&#x3D;output:2</span><br><span class="line">dpctl add-flow dl_type&#x3D;0x0800,nw_dst&#x3D;10.0.0.1,actions&#x3D;output:1</span><br><span class="line">dpctl dump-flows</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行命令ping h2 和h3：</p>
<pre><code>![image-20210907030326211](/picture/image-20210907030326211.png)
</code></pre></li>
</ol>
<p>​    可以看到无法ping通</p>
<ol start="13">
<li><p>在主机h2,h3上面查看:</p>
<p><img src="/picture/image-20210907030627886.png" alt="image-20210907030627886"></p>
<p>原理解析：用dpctl对交换机添加flow，让交换机把所有EtherType为0x0800（IPv4）并且destiation IP为10.0.0.2的traffic从s1-eth2这个端口发出去。用dpctl对交换机添加flow，让交换机把所有EtherType为0x0800（IPv4）并且destiation IP为10.0.0.1的traffic从s1-eth1这个端口发出去。但处在同一网段下的主机，它们之间的交流是L2 forwarding，需要靠ARP来解析MAC地址，之前只匹配了0x0800(IPv4)协议，并没有匹配到0x0806(ARP)，这样当交换机收到h1的ARP包后，因为没有控制器，flow table里面也没有相应的flow告诉它如何转发这个ARP包，交换机只能将它丢弃，从而导致h1 ping h2失败，所以需要添加ARP协议的流表来使通信。</p>
</li>
<li><p>执行命令<code>dpctl add-flow dl_type=0x0806,actions=NORMAL</code>添加ARP(0x0806)协议相关的流表，让交换机以NORMAL形式（广播）将所有ARP包从各个端口广播出去:</p>
</li>
<li><p>执行dpctl dump-flows查看:</p>
<p><img src="/picture/image-20210907030845798.png" alt="image-20210907030845798"></p>
<p>然后ping h2和h3 发现可以ping通h2:</p>
<p><img src="/picture/image-20210907030928420.png" alt="image-20210907030928420"></p>
<p><img src="/picture/image-20210907030936961.png" alt="image-20210907030936961"></p>
</li>
</ol>
<h2 id="Mininet流表应用实战——控制器下发流表协议分析"><a href="#Mininet流表应用实战——控制器下发流表协议分析" class="headerlink" title="Mininet流表应用实战——控制器下发流表协议分析"></a>Mininet流表应用实战——控制器下发流表协议分析</h2><ol>
<li>实验原理：在SDN环境下，当交换机收到一个数据包并且交换机中没有与改数据包匹配的流表项的时候，交换机将此数据包发给控制器，由控制器决策数据包如何处理，控制器下发决策后，交换机根据控制器下发的信息来进行数据包的处理，即转发或者丢弃这个数据包。</li>
<li>这个实验做了一下，基本就是控制器，主机两个，主机上进行抓包然后分析协议</li>
</ol>
<h2 id="Mininet-多数据中心网络拓扑流量带宽实验"><a href="#Mininet-多数据中心网络拓扑流量带宽实验" class="headerlink" title="Mininet 多数据中心网络拓扑流量带宽实验"></a>Mininet 多数据中心网络拓扑流量带宽实验</h2><ol>
<li>使用mininet中的iperf工具在网络中生成UDP流量，iperf客户端传送数据流到iperf的服务端，由服务端接收并记录相关信息。网络性能评估中一个巨大的挑战就是如何生成真实的网络流量，可以通过程序来创造人工的网络流量，通过建立测试环境来模拟真实的状况。此应用主要以数据中心网络为目标场景，在mininet仿真环境中尽可能地还原数据中心内部的真实流量情况。</li>
<li><p>Mininet数据中心应用价值：</p>
<ul>
<li>树状拓扑结构容错能力强</li>
<li>降低数据中心成本消耗</li>
<li>提供重新排列的全带宽无阻碍路径</li>
<li>提高带宽利用率</li>
<li>分析数据中心网络流量性能</li>
<li>为真实数据中心和仿真测试床提供有用信息</li>
</ul>
</li>
<li><p>在mininet中进行自定义命令iperfmulti功能拓展主要分为4步：<br> 1.修改mininet/net.py<br> 2.修改mininet/cli.py<br> 3.修改bin/mn<br> 4.重新安装Mininet核心文件：~/mininet/util/install.sh -n</p>
</li>
<li><p>实验拓扑:</p>
<p><img src="/picture/image-20210907215209183.png" alt="image-20210907215209183"></p>
</li>
<li><p>实验设备：</p>
<p><img src="/picture/image-20210907221043663.png" alt="image-20210907221043663"></p>
</li>
</ol>
<h3 id="编写网络带宽测试程序"><a href="#编写网络带宽测试程序" class="headerlink" title="编写网络带宽测试程序"></a>编写网络带宽测试程序</h3><ol>
<li><p>在mininet/net.py中的”def iperf”下面添加定义iperf_single()函数实现两个主机间的iperf udp 测试,代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iperf_single</span><span class="params">( self,hosts=None, udpBw=<span class="string">'10M'</span>, period=<span class="number">60</span>, port=<span class="number">5001</span>)</span>:</span></span><br><span class="line">        <span class="string">"""Run iperf between two hosts using UDP.</span></span><br><span class="line"><span class="string">           hosts: list of hosts; if None, uses opposite hosts</span></span><br><span class="line"><span class="string">           returns: results two-element array of server and client speeds"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hosts:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> len( hosts ) == <span class="number">2</span></span><br><span class="line">        client, server = hosts</span><br><span class="line">        filename = client.name[<span class="number">1</span>:] + <span class="string">'.out'</span></span><br><span class="line">        output( <span class="string">'*** Iperf: testing bandwidth between '</span> )</span><br><span class="line">        output( <span class="string">"%s and %s\n"</span> % ( client.name, server.name ) )</span><br><span class="line">        iperfArgs = <span class="string">'iperf -u '</span></span><br><span class="line">        bwArgs = <span class="string">'-b '</span> + udpBw + <span class="string">' '</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"***start server***"</span></span><br><span class="line">        server.cmd( iperfArgs + <span class="string">'-s -i 1'</span> + <span class="string">' &gt; /home/sdnlab/log/'</span> + filename + <span class="string">'&amp;'</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"***start client***"</span></span><br><span class="line">        client.cmd(</span><br><span class="line">            iperfArgs + <span class="string">'-t '</span>+ str(period) + <span class="string">' -c '</span> + server.IP() + <span class="string">' '</span> + bwArgs</span><br><span class="line">            +<span class="string">' &gt; /home/sdnlab/log/'</span> + <span class="string">'client'</span> + filename +<span class="string">'&amp;'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210907220635571.png" alt="image-20210907220635571"></p>
</li>
<li><p>在Mininet类中添加自定义命令iperfmulti()函数，这个函数的作用使实现为每一台主机随机选择另一台主机作为iperf的服务器段，通过调用iperf_single，自身以客户端的身份按照指令参数发送UDP流，服务器生成的报告以重定向的方式输出到文件中。使用iperfmulti命令，主机随机地向另一台主机发起一个恒定带宽的UDP数据流。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iperfMulti</span><span class="params">(self, bw, period=<span class="number">60</span>)</span>:</span></span><br><span class="line">       base_port = <span class="number">5001</span></span><br><span class="line">       server_list = []</span><br><span class="line">       client_list = [h <span class="keyword">for</span> h <span class="keyword">in</span> self.hosts]</span><br><span class="line">       host_list = []</span><br><span class="line">       host_list = [h <span class="keyword">for</span> h <span class="keyword">in</span> self.hosts]</span><br><span class="line">   </span><br><span class="line">       cli_outs = []</span><br><span class="line">       ser_outs = []</span><br><span class="line">   </span><br><span class="line">       _len = len(host_list)</span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, _len):</span><br><span class="line">           client = host_list[i]</span><br><span class="line">           server = client</span><br><span class="line">           <span class="keyword">while</span>( server == client ):</span><br><span class="line">               server = random.choice(host_list)</span><br><span class="line">           server_list.append(server)</span><br><span class="line">           self.iperf_single(hosts = [client, server], udpBw=bw, period= period, port=base_port)</span><br><span class="line">           sleep(<span class="number">.05</span>)</span><br><span class="line">           base_port += <span class="number">1</span></span><br><span class="line">   </span><br><span class="line">       sleep(period)</span><br><span class="line">       <span class="keyword">print</span> <span class="string">"test has done"</span></span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210907220651767.png" alt="image-20210907220651767"></p>
</li>
<li><p>打开/mininet/cli.py文件，加入如下代码，注册iperfmulti命令:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_iperfmulti</span><span class="params">( self, line )</span>:</span></span><br><span class="line">        <span class="string">"""Multi iperf UDP test between nodes"""</span></span><br><span class="line">        args = line.split()</span><br><span class="line">        <span class="keyword">if</span> len(args) == <span class="number">1</span>:</span><br><span class="line">            udpBw = args[ <span class="number">0</span> ]</span><br><span class="line">            self.mn.iperfMulti(udpBw)</span><br><span class="line">        <span class="keyword">elif</span> len(args) == <span class="number">2</span>:</span><br><span class="line">            udpBw = args[ <span class="number">0</span> ]</span><br><span class="line">            period = args[ <span class="number">1</span> ]</span><br><span class="line">            err = <span class="literal">False</span></span><br><span class="line">            self.mn.iperfMulti(udpBw, float(period))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error(<span class="string">'invalid number of args: iperfmulti udpBw period\n'</span> +<span class="string">'udpBw examples: 1M 120\n'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/picture/image-20210907220705100.png" alt="image-20210907220705100"></p>
</li>
<li><p>使用<code>sudo vim mininet/bin/mn</code>，加入iperfmulti可执行命令:</p>
<p><img src="/picture/image-20210907220743581.png" alt="image-20210907220743581"></p>
</li>
<li><p>执行如下命令重新编译Mininet:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd openlab&#x2F;mininet&#x2F;util</span><br><span class="line">.&#x2F;install.sh -n</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用sudo mn 创建一个topo查看是否存在iperfmulti命令，作为验证：</p>
<p><img src="/picture/image-20210907220846860.png" alt="image-20210907220846860"></p>
</li>
</ol>
<h3 id="构建多数据中心拓扑"><a href="#构建多数据中心拓扑" class="headerlink" title="构建多数据中心拓扑"></a>构建多数据中心拓扑</h3><ol>
<li><p>在/mininet/custom中创建fattree.py，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="string">"""Custom topology example</span></span><br><span class="line"><span class="string">Adding the 'topos' dict with a key/value pair to generate our newly defined</span></span><br><span class="line"><span class="string">topology enables one to pass in '--topo=mytopo' from the command line.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> mininet.topo <span class="keyword">import</span> Topo</span><br><span class="line"><span class="keyword">from</span> mininet.net <span class="keyword">import</span> Mininet</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> RemoteController,CPULimitedHost</span><br><span class="line"><span class="keyword">from</span> mininet.link <span class="keyword">import</span> TCLink</span><br><span class="line"><span class="keyword">from</span> mininet.util <span class="keyword">import</span> dumpNodeConnections</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTopo</span><span class="params">( Topo )</span>:</span></span><br><span class="line">    <span class="string">"Simple topology example."</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">( self )</span>:</span></span><br><span class="line">        <span class="string">"Create custom topo."</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize topology</span></span><br><span class="line">        Topo.__init__( self )</span><br><span class="line">        L1 = <span class="number">2</span></span><br><span class="line">        L2 = L1 * <span class="number">2</span> </span><br><span class="line">        L3 = L2</span><br><span class="line">        c = []</span><br><span class="line">        a = []</span><br><span class="line">        e = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add core ovs  </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range( L1 ):</span><br><span class="line">                sw = self.addSwitch( <span class="string">'c&#123;&#125;'</span>.format( i + <span class="number">1</span> ) )</span><br><span class="line">                c.append( sw )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add aggregation ovs</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range( L2 ):</span><br><span class="line">                sw = self.addSwitch( <span class="string">'a&#123;&#125;'</span>.format( L1 + i + <span class="number">1</span> ) )</span><br><span class="line">                a.append( sw )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add edge ovs</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range( L3 ):</span><br><span class="line">                sw = self.addSwitch( <span class="string">'e&#123;&#125;'</span>.format( L1 + L2 + i + <span class="number">1</span> ) )</span><br><span class="line">                e.append( sw )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add links between core and aggregation ovs</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range( L1 ):</span><br><span class="line">                sw1 = c[i]</span><br><span class="line">                <span class="keyword">for</span> sw2 <span class="keyword">in</span> a[i/<span class="number">2</span>::L1/<span class="number">2</span>]:</span><br><span class="line">                <span class="comment"># self.addLink(sw2, sw1, bw=10, delay='5ms', loss=10, max_queue_size=1000, use_htb=True)</span></span><br><span class="line">                        self.addLink( sw2, sw1 )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add links between aggregation and edge ovs</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range( <span class="number">0</span>, L2, <span class="number">2</span> ):</span><br><span class="line">                <span class="keyword">for</span> sw1 <span class="keyword">in</span> a[i:i+<span class="number">2</span>]:</span><br><span class="line">                    <span class="keyword">for</span> sw2 <span class="keyword">in</span> e[i:i+<span class="number">2</span>]:</span><br><span class="line">                        self.addLink( sw2, sw1 )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#add hosts and its links with edge ovs</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> sw1 <span class="keyword">in</span> e:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                    host = self.addHost( <span class="string">'h&#123;&#125;'</span>.format( count ) )</span><br><span class="line">                    self.addLink( sw1, host )</span><br><span class="line">                    count += <span class="number">1</span></span><br><span class="line">topos = &#123; <span class="string">'mytopo'</span>: ( <span class="keyword">lambda</span>: MyTopo() ) &#125;</span><br></pre></td></tr></table></figure>
<p>Mininet创建网络拓扑的代码中，可以通过改变代码中定义的L1变量来设置核心交换机的数量，并通过添加额外的交换机和链路来构成更复杂的数据中心网络拓扑。随着边缘交换机的增加，主机个数也随之增长，利用Mininet的易用性和扩展性，可以创建基于多种数据中心场景下的网络拓扑，达到更好更全面的实验效果。</p>
</li>
<li><p>在控制器主机上面用ifconfig看主机的ip:</p>
<p><img src="/picture/image-20210907221233085.png" alt="image-20210907221233085"></p>
</li>
<li><p>在host，也就是mininet所在的主机上面使用如下命令生成测试拓扑结构:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --custom fattree.py --topo mytopo --controller&#x3D;remote,ip&#x3D;30.0.1.69,port&#x3D;6653</span><br></pre></td></tr></table></figure>
<p>这里ip以上面查出来的为准；</p>
<p>用<code>pingall</code>验证连通性</p>
</li>
<li><p>控制器上通过OPENDAYLIGHT，在浏览器:<code>http://30.0.1.69:8181/index.html</code>中可以看到ODL控制器。查看拓扑如下:</p>
<p><img src="/picture/image-20210907221616586.png" alt="image-20210907221616586"></p>
</li>
<li><p>在mininet主机上面可以iperf h1 h2测主机间带宽</p>
</li>
<li><p>使用<code>iperfmulti 0.025M</code>可以看到8太主机随机向另外的主机发数据包，然后数据记录在/home/sdnlab/log里面。</p>
<p><img src="/picture/image-20210907221750866.png" alt="image-20210907221750866"></p>
</li>
</ol>
<blockquote>
<p>这个实验可以用来借鉴测试速度之类的实验</p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2021-09-11T10:00:51.121Z" itemprop="dateUpdated">2021-09-11 18:00:51</time>
</span><br>


        
        Link：<a href="/2021/09/03/mininetlab/" target="_blank" rel="external">http://tyler-ytr.github.io/2021/09/03/mininetlab/</a>
        
    </div>
    
    <footer>
        <a href="http://Tyler-ytr.github.io">
            <img src="/img/Tyler.png" alt="Tyler-yin">
            Tyler-yin
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mininet/" rel="tag">mininet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%9E%E9%AA%8C%E5%9F%BA%E7%A1%80/" rel="tag">实验基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&title=《mininetlab 学习》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&title=《mininetlab 学习》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2021/09/03/mininetlab/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《mininetlab 学习》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/09/11/ns-learning/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ns_learning</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/08/02/cs144-1/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">cs144_1</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "NoLhoWnmbSW89zV4zc04RPwx-gzGzoHsz",
            appKey: "SSdRGaHcdjoKc7cJJpOlJIqJ",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Tyler-yin &copy; 2015 - 2023</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&title=《mininetlab 学习》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&title=《mininetlab 学习》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2021/09/03/mininetlab/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《mininetlab 学习》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2021/09/03/mininetlab/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2021/09/03/mininetlab/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3awYrDMAxF0f7/T2dgVgOh6X1SOhDpehVoavtkISxLrxcex+8gv56fr8d5nuu1WkOGDBmPZZBlrpcncxI8WfftnDJkyFjA4MtcL8B5afj+sGcZMmTIaG+RfwIZMmTI6DPIdkmw5mFdhgwZMngSy5NPHlj778iQIWMDIy0M/OfzF+sbMmTIeAjjCEftv2lxNN6VDBkyRjNI+ZBfrqXv82YONI8MGTKGMt4Fu3S7/EPwEmYwjwwZMhYwaqXE2uGvv0pwwpUhQ8YgRq0VrLVwWPhEubgMGTJGMzrHNU4leB6CURYuQ4aM0YzrTaShOQ2ypKUDBVwZMmQMYpDA10lfSSk03vrf92XIkDGawbfLeZxEwncQymXIkDGU0Tmc8ZSVg9NDqgwZMnYyeMjrtI6l6wbNFjJkyFjASFNN0lrxjeYMGTJkbGPULtfSQyQvZ6bBV4YMGbMZ/Lq/00KRXtXxOT80XsiQIWMoIz0I3nX133lHhgwZsxm8SNkvOqbBPfg0MmTIWMloXX6Fh8JaUi1Dhow9jE7ZslZOIKGcU9H5VIYMGQ9nHOHg/+KXZWkQR0dDGTJkDGLcFa3TckLtGRUGZMiQMZRxV5DlgfiGK7YzUoYMGQsYtQYInqbyoFwM/TJkyJARboVvrnN8LAZcGTJkrGHUSpK1a7UgiZUhQ8ZoBk9i0/aI/kAprgwZMkYzaqkjL092ktU0JZYhQ8Y4xg/1MaOJusioCAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '＞﹏＜';
            clearTimeout(titleTime);
        } else {
            document.title = '~\(≧▽≦)/~';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>


</body>
</html>
