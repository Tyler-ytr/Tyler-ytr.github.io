<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>p4学习-4:P4runtime实验 | Tyler-yin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="p4">
    <meta name="description" content="p4学习-4:P4runtime实验实验目标使用P4Runtime而不是来交换机的CLI发送flow entries;P4程序是在basic tunnel里面的程序的基础上写的，改名叫了 advanced_tunnel.p4，并且增加了两个counters(ingressTunnelCounter, egressTunnelCounter)和两个actions(myTunnel_ingress,">
<meta property="og:type" content="article">
<meta property="og:title" content="p4学习-4:P4runtime实验">
<meta property="og:url" content="http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/index.html">
<meta property="og:site_name" content="Tyler-yin&#39;s blog">
<meta property="og:description" content="p4学习-4:P4runtime实验实验目标使用P4Runtime而不是来交换机的CLI发送flow entries;P4程序是在basic tunnel里面的程序的基础上写的，改名叫了 advanced_tunnel.p4，并且增加了两个counters(ingressTunnelCounter, egressTunnelCounter)和两个actions(myTunnel_ingress,">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210303234909688.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210304163414071.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/topo_basic_tunnel-1614931073774.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210305163701102.png">
<meta property="og:image" content="http://tyler-ytr.github.io/picture/image-20210305163722778.png">
<meta property="article:published_time" content="2021-03-02T14:06:07.000Z">
<meta property="article:modified_time" content="2021-03-05T08:44:52.946Z">
<meta property="article:author" content="Tyler-yin">
<meta property="article:tag" content="p4">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tyler-ytr.github.io/picture/image-20210303234909688.png">
    
        <link rel="alternate" type="application/atom+xml" title="Tyler-yin&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/Tyler.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Tyler-yin</h5>
          <a href="mailto:ytrpossible@gmail.com" title="ytrpossible@gmail.com" class="mail">ytrpossible@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Index
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Tyler-ytr/" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-address-book"></i>
                Friends
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-link"></i>
                link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">p4学习-4:P4runtime实验</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">p4学习-4:P4runtime实验</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-03-02T14:06:07.000Z" itemprop="datePublished" class="page-time">
  2021-03-02
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/p4%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/">p4语言学习</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#p4学习-4-P4runtime实验"><span class="post-toc-number">1.</span> <span class="post-toc-text">p4学习-4:P4runtime实验</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#实验目标"><span class="post-toc-number">1.0.1.</span> <span class="post-toc-text">实验目标</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#代码部分"><span class="post-toc-number">1.0.2.</span> <span class="post-toc-text">代码部分</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#实验过程"><span class="post-toc-number">1.0.3.</span> <span class="post-toc-text">实验过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-跑未完成的代码"><span class="post-toc-number">1.0.3.1.</span> <span class="post-toc-text">1 跑未完成的代码</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-完善隧道转发"><span class="post-toc-number">1.0.3.2.</span> <span class="post-toc-text">2 完善隧道转发</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-实验结果"><span class="post-toc-number">1.0.3.3.</span> <span class="post-toc-text">3 实验结果</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#额外参考——rpc-grpc学习"><span class="post-toc-number">1.0.4.</span> <span class="post-toc-text">额外参考——rpc,grpc学习</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#参考博客"><span class="post-toc-number">1.0.5.</span> <span class="post-toc-text">参考博客</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-p4学习-4"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">p4学习-4:P4runtime实验</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-03-02 22:06:07" datetime="2021-03-02T14:06:07.000Z"  itemprop="datePublished">2021-03-02</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/p4%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/">p4语言学习</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="p4学习-4-P4runtime实验"><a href="#p4学习-4-P4runtime实验" class="headerlink" title="p4学习-4:P4runtime实验"></a>p4学习-4:P4runtime实验</h2><h4 id="实验目标"><a href="#实验目标" class="headerlink" title="实验目标"></a>实验目标</h4><p>使用P4Runtime而不是来交换机的CLI发送flow entries;P4程序是在basic tunnel里面的程序的基础上写的，改名叫了 <code>advanced_tunnel.p4</code>，并且增加了两个counters(<code>ingressTunnelCounter</code>, <code>egressTunnelCounter</code>)和两个actions(<code>myTunnel_ingress</code>, <code>myTunnel_egress</code>)</p>
<p>使用启动程序<code>mycontroller.py</code>以及一些 <code>p4runtime_lib</code> 库里面的函数来创建主机1和主机2之间隧道通信所需的表项。</p>
<h4 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h4><p>主要是<code>mycontroller.py</code>里面的<code>writeTunnelRules</code>函数的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import P4Runtime lib from parent utils dir</span></span><br><span class="line"><span class="comment"># Probably there's a better way of doing this.</span></span><br><span class="line">sys.path.append(</span><br><span class="line">    os.path.join(os.path.dirname(os.path.abspath(__file__)),</span><br><span class="line">                 <span class="string">'../../utils/'</span>))</span><br><span class="line"><span class="keyword">import</span> p4runtime_lib.bmv2</span><br><span class="line"><span class="keyword">from</span> p4runtime_lib.switch <span class="keyword">import</span> ShutdownAllSwitchConnections</span><br><span class="line"><span class="keyword">import</span> p4runtime_lib.helper</span><br><span class="line"></span><br><span class="line">SWITCH_TO_HOST_PORT = <span class="number">1</span></span><br><span class="line">SWITCH_TO_SWITCH_PORT = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeTunnelRules</span><span class="params">(p4info_helper, ingress_sw, egress_sw, tunnel_id,</span></span></span><br><span class="line"><span class="function"><span class="params">                     dst_eth_addr, dst_ip_addr)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Installs three rules:</span></span><br><span class="line"><span class="string">    1) An tunnel ingress rule on the ingress switch in the ipv4_lpm table that encapsulates traffic into a tunnel with the specified ID</span></span><br><span class="line"><span class="string">    ipv4_lpm表的入接口开关上的隧道入接口规则，该规则用指定的ID将流量封装到一个隧道中</span></span><br><span class="line"><span class="string">    2) A transit rule on the ingress switch that forwards traffic based on the specified ID</span></span><br><span class="line"><span class="string">    入口交换机上的一种传输规则，根据指定的ID转发流量</span></span><br><span class="line"><span class="string">    3) An tunnel egress rule on the egress switch that decapsulates traffic with the specified ID and sends it to the host</span></span><br><span class="line"><span class="string">    出口交换机上的一条隧道出口规则，将指定ID的流量解封装后发送给主机</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param p4info_helper: the P4Info helper</span></span><br><span class="line"><span class="string">    :param ingress_sw: the ingress switch connection</span></span><br><span class="line"><span class="string">    :param egress_sw: the egress switch connection</span></span><br><span class="line"><span class="string">    :param tunnel_id: the specified tunnel ID</span></span><br><span class="line"><span class="string">    :param dst_eth_addr: the destination IP to match in the ingress rule</span></span><br><span class="line"><span class="string">    :param dst_ip_addr: the destination Ethernet address to write in the egress rule</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 1) Tunnel Ingress Rule</span></span><br><span class="line">    table_entry = p4info_helper.buildTableEntry(</span><br><span class="line">        table_name=<span class="string">"MyIngress.ipv4_lpm"</span>,</span><br><span class="line">        match_fields=&#123;</span><br><span class="line">            <span class="string">"hdr.ipv4.dstAddr"</span>: (dst_ip_addr, <span class="number">32</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        action_name=<span class="string">"MyIngress.myTunnel_ingress"</span>,</span><br><span class="line">        action_params=&#123;</span><br><span class="line">            <span class="string">"dst_id"</span>: tunnel_id,</span><br><span class="line">        &#125;)</span><br><span class="line">    ingress_sw.WriteTableEntry(table_entry)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Installed ingress tunnel rule on %s"</span> % ingress_sw.name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2) Tunnel Transit Rule</span></span><br><span class="line">    <span class="comment"># The rule will need to be added to the myTunnel_exact table and match on the tunnel ID (hdr.myTunnel.dst_id). Traffic will need to be forwarded using the myTunnel_forward action on the port connected to the next switch.这条规则是添加到myTunnel_exact table上面的，match的部分是tunnel ID (hdr.myTunnel.dst_id)。流量将会使用myTunnel_forward action转发到连接下一个交换机的端口，这里要观察下面的拓扑图会发现连接交换机(h1,h2)的都是二号端口，文件里面用SWITCH_TO_SWITCH_PORT表示了2号端口</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># For our simple topology, switch 1 and switch 2 are connected using a link attached to port 2 on both switches. We have defined a variable at the top of the file, SWITCH_TO_SWITCH_PORT, that you can use as the output port for this action.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># We will only need a transit rule on the ingress switch because we are using a simple topology. In general, you'll need on transit rule for each switch in the path (except the last switch, which has the egress rule), and you will need to select the port dynamically for each switch based on your topology.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TODO build the transit rule</span></span><br><span class="line">    <span class="comment"># TODO install the transit rule on the ingress switch</span></span><br><span class="line">    <span class="comment">#print "TODO Install transit tunnel rule"</span></span><br><span class="line">	table_entry=p4info_helper.buildTableEntry(</span><br><span class="line">    	table_name=<span class="string">"MyIngress.myTunnel_exact"</span>,</span><br><span class="line">        match_fields=&#123;</span><br><span class="line">            <span class="string">"hdr.myTunnel.dst_id"</span>:tunnel_id</span><br><span class="line">        &#125;,</span><br><span class="line">        action_name=<span class="string">"MyIngress.myTunnel_forward"</span>,</span><br><span class="line">        action_params=&#123;</span><br><span class="line">            <span class="string">"port"</span>:SWITCH_TO_SWITCH_PORT</span><br><span class="line">        &#125;)</span><br><span class="line">    ingress_sw.WriteTableEntry(table_entry)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Installed transit tunnel rule on %s"</span> % ingress_sw.name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3) Tunnel Egress Rule</span></span><br><span class="line">    <span class="comment"># For our simple topology, the host will always be located on the SWITCH_TO_HOST_PORT (port 1).</span></span><br><span class="line">    <span class="comment"># In general, you will need to keep track of which port the host is connected to.</span></span><br><span class="line">    table_entry = p4info_helper.buildTableEntry(</span><br><span class="line">        table_name=<span class="string">"MyIngress.myTunnel_exact"</span>,</span><br><span class="line">        match_fields=&#123;</span><br><span class="line">            <span class="string">"hdr.myTunnel.dst_id"</span>: tunnel_id</span><br><span class="line">        &#125;,</span><br><span class="line">        action_name=<span class="string">"MyIngress.myTunnel_egress"</span>,</span><br><span class="line">        action_params=&#123;</span><br><span class="line">            <span class="string">"dstAddr"</span>: dst_eth_addr,</span><br><span class="line">            <span class="string">"port"</span>: SWITCH_TO_HOST_PORT</span><br><span class="line">        &#125;)</span><br><span class="line">    egress_sw.WriteTableEntry(table_entry)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Installed egress tunnel rule on %s"</span> % egress_sw.name</span><br><span class="line">    </span><br><span class="line"><span class="comment">#### 下面的函数省略不表</span></span><br></pre></td></tr></table></figure>
<p>实际写的时候主要依靠下面的Tunnel Egress Rule规则仿写,主要p4文件里面:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*************************************************************************</span></span><br><span class="line"><span class="comment">**************  I N G R E S S   P R O C E S S I N G   *******************</span></span><br><span class="line"><span class="comment">*************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="function">control <span class="title">MyIngress</span><span class="params">(inout headers hdr,</span></span></span><br><span class="line"><span class="function"><span class="params">                  inout metadata meta,</span></span></span><br><span class="line"><span class="function"><span class="params">                  inout <span class="keyword">standard_metadata_t</span> standard_metadata)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    counter(MAX_TUNNEL_ID, CounterType.packets_and_bytes) ingressTunnelCounter;</span><br><span class="line">    counter(MAX_TUNNEL_ID, CounterType.packets_and_bytes) egressTunnelCounter;</span><br><span class="line"></span><br><span class="line">    <span class="function">action <span class="title">drop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mark_to_drop(standard_metadata);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">action <span class="title">ipv4_forward</span><span class="params">(macAddr_t dstAddr, egressSpec_t port)</span> </span>&#123;</span><br><span class="line">        standard_metadata.egress_spec = port;</span><br><span class="line">        hdr.ethernet.srcAddr = hdr.ethernet.dstAddr;</span><br><span class="line">        hdr.ethernet.dstAddr = dstAddr;</span><br><span class="line">        hdr.ipv4.ttl = hdr.ipv4.ttl - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">action <span class="title">myTunnel_ingress</span><span class="params">(<span class="built_in">bit</span>&lt;<span class="number">16</span>&gt; dst_id)</span> </span>&#123;</span><br><span class="line">        hdr.myTunnel.setValid();</span><br><span class="line">        hdr.myTunnel.dst_id = dst_id;</span><br><span class="line">        hdr.myTunnel.proto_id = hdr.ethernet.etherType;</span><br><span class="line">        hdr.ethernet.etherType = TYPE_MYTUNNEL;</span><br><span class="line">        ingressTunnelCounter.count((<span class="built_in">bit</span>&lt;<span class="number">32</span>&gt;) hdr.myTunnel.dst_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">action <span class="title">myTunnel_forward</span><span class="params">(egressSpec_t port)</span> </span>&#123;</span><br><span class="line">        standard_metadata.egress_spec = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">action <span class="title">myTunnel_egress</span><span class="params">(macAddr_t dstAddr, egressSpec_t port)</span> </span>&#123;</span><br><span class="line">        standard_metadata.egress_spec = port;</span><br><span class="line">        hdr.ethernet.dstAddr = dstAddr;</span><br><span class="line">        hdr.ethernet.etherType = hdr.myTunnel.proto_id;</span><br><span class="line">        hdr.myTunnel.setInvalid();</span><br><span class="line">        egressTunnelCounter.count((<span class="built_in">bit</span>&lt;<span class="number">32</span>&gt;) hdr.myTunnel.dst_id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    table ipv4_lpm &#123;</span><br><span class="line">        key = &#123;</span><br><span class="line">            hdr.ipv4.dstAddr: lpm;</span><br><span class="line">        &#125;</span><br><span class="line">        actions = &#123;</span><br><span class="line">            ipv4_forward;</span><br><span class="line">            myTunnel_ingress;</span><br><span class="line">            drop;</span><br><span class="line">            NoAction;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">size</span> = <span class="number">1024</span>;</span><br><span class="line">        default_action = NoAction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    table myTunnel_exact &#123;</span><br><span class="line">        key = &#123;</span><br><span class="line">            hdr.myTunnel.dst_id: exact;</span><br><span class="line">        &#125;</span><br><span class="line">        actions = &#123;</span><br><span class="line">            myTunnel_forward;</span><br><span class="line">            myTunnel_egress;</span><br><span class="line">            drop;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">size</span> = <span class="number">1024</span>;</span><br><span class="line">        default_action = drop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    apply &#123;</span><br><span class="line">        <span class="keyword">if</span> (hdr.ipv4.<span class="built_in">isValid</span>() &amp;&amp; !hdr.myTunnel.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">            <span class="comment">// Process only non-tunneled IPv4 packets.</span></span><br><span class="line">            ipv4_lpm.apply();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hdr.myTunnel.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">            <span class="comment">// Process all tunneled packets.</span></span><br><span class="line">            myTunnel_exact.apply();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>match_field里面相当于action里面的key部分,具体的值由控制平面也就是函数里面的<code>tunnel_id</code>确定;action_name里面相当于调用了<code>action myTunnel_forward</code>,这个action的参数只有<code>port</code>,又因为题目里面的提示要求port是<code>SWITCH_TO_SWITCH_PORT</code>因此填进去就行了;</p>
<h4 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h4><h5 id="1-跑未完成的代码"><a href="#1-跑未完成的代码" class="headerlink" title="1 跑未完成的代码"></a>1 跑未完成的代码</h5><ol>
<li><p><code>mycontroller.py</code>里面包含了一些隧道通信需要的规则，在没有完成的情况下先跑p4看看啥样:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<ul>
<li>这步编译了 <code>advanced_tunnel.p4</code>,</li>
<li>启动一个Mininet实例，其中三个交换机(<code>s1</code>, <code>s2</code>, <code>s3</code>)配置在一个三角形中，每个交换机连接到一个主机(<code>h1</code>, <code>h2</code>, <code>h3</code>)，并且把<code>10.0.1.1</code>, <code>10.0.2.2</code>, <code>10.0.3.3</code>这些IP配置到对应的主机上</li>
</ul>
</li>
<li><p>现在会看到mininet命令窗口，ping h1 和 h2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; h1 ping h2</span><br></pre></td></tr></table></figure>
<p>因为交换机上面没有规则，现在还没法接受回应，然后如果ctrl+C就如下图各种丢包；</p>
<p><img src="/picture/image-20210303234909688.png" alt="image-20210303234909688"></p>
<p>现在把这个ping留着继续跑然后开另一个shell</p>
</li>
<li><p>在另一个shell里面跑:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/tutorials/exercises/p4runtime</span><br><span class="line">./mycontroller.py</span><br></pre></td></tr></table></figure>
<p>这会安装<code>advanced_tunnel.p4</code>程序到switch上面并且把tunnel ingress规则推进去；这个程序每两秒打印ingress和egress的counters</p>
<p><img src="/picture/image-20210304163414071.png" alt="image-20210304163414071"></p>
<p>因为目前没有完成还有一些TODO的部分，所以下面可以看到这些包经过s1的ingress并且让计数器增加；</p>
</li>
<li><p>Ctrl-c退出</p>
<p>目前的交换机是根据目的IP地址将流量映射到隧道(ID)上面，要做的工作是写规则，从而让交换机能够基于隧道(tunnel) ID来转发流量 </p>
</li>
</ol>
<blockquote>
<p>和前面的对比：之前的都是依靠一些json文件静态的设置表项，这里是动态的；要注意到p4 程序仅仅定义了一个包处理的管道，但是是不包含具体的规则的；</p>
<p>P4程序定义了包处理管道（规则由控制平面插入），同时定义了交互机的pipeline和控制平面的接口（这部分在advanced_tunnel.p4info）里面；在mycontroller. py里面构建的表项(table entries)会根据名称引用特定的表、键和actions；使用p4info会将名字转换程P4runtime所需要的ID。在P4程序中添加或者重命名的表、键、actions都要反映在 py程序的表项(table entries)里面</p>
</blockquote>
<h5 id="2-完善隧道转发"><a href="#2-完善隧道转发" class="headerlink" title="2 完善隧道转发"></a>2 完善隧道转发</h5><ol>
<li><p>p4runtime_lib库里面的总结,这部分代码在tutorials/utils/p4runtime_lib里面:</p>
<ul>
<li><p><code>p4runtime_lib.helper</code></p>
<ul>
<li>包含了<code>P4InfoHelper</code> 类能够解析<code>P4Info</code>文件，包括了name,id,alias,match_field(本身/id/name/pb/value)，action_param(本身/id/name/pb)</li>
<li>提供了实体的名字到ID数字转换的方法(buildTableEnrty函数)</li>
<li>构建P4Runtime表项的P4依赖于程序的部分。</li>
</ul>
</li>
<li><p><code>p4runtime_lib.switch.py</code></p>
<ul>
<li>包括了<code>SwitchConnection</code>类，会获取gRPC的client stub以及给交换机建立连接</li>
<li>提供了helper方法，能够构建P4Runtime协议的buffer信息以及制作P4Runtime gRPC service calls</li>
</ul>
</li>
<li><p><code>p4runtime_lib.bmv2.py</code></p>
<ul>
<li><p>包含了 <code>Bmv2SwitchConnection</code> 类，它拓展了<code>SwitchConnections</code>并且提供了BMv2-specific 设备载荷来装载P4程序</p>
<blockquote>
<p> PS:实际上是重载了SwitchConnection 然后多了一个buildDeviceConfig函数能够根据bmv2_json_file来返回设备的配置</p>
</blockquote>
</li>
</ul>
</li>
<li><p><code>p4runtime_lib.convert.py</code></p>
<ul>
<li>由<code>helper.py</code>调用</li>
<li>主要提供了一些把数字/字符串编码协议buffer信息需要的格式的方法以及相应的解码方法</li>
</ul>
</li>
</ul>
</li>
<li><p><code>mycontroller.py</code>是一个结能的控制平面做了以下的事情</p>
<ol>
<li>为P4Runtime服务构建了一个到交换机的 gRPC连接</li>
<li>把P4程序push给各个交换机</li>
<li>在h1,h2之间的两个隧道编写了ingress/egress规则</li>
<li>每两秒读隧道的ingress/egress计数器</li>
</ol>
</li>
<li><p>代码部分主要要做的事情是在 <code>writeTunnelRules</code>函数里面写隧道转发规则，它对应于隧道ID并且能够把包转发到下一跳</p>
</li>
<li><p>拓扑图如下:</p>
<p><img src="/picture/topo_basic_tunnel-1614931073774.png" alt="topology"></p>
</li>
</ol>
<h5 id="3-实验结果"><a href="#3-实验结果" class="headerlink" title="3 实验结果"></a>3 实验结果</h5><p>先<code>make clean</code>再<code>make</code>，然后<code>h1 ping h2</code>，然后开一个新端口<code>./mycontroller.py</code>，这个时候可以看见ingress,egress的计数都上涨了:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20210305163701102.png" alt="py_info" title="">
                </div>
                <div class="image-caption">py_info</div>
            </figure>
<p>另外ping也能够成功的收到了:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/picture/image-20210305163722778.png" alt="mini_info" title="">
                </div>
                <div class="image-caption">mini_info</div>
            </figure>
<h4 id="额外参考——rpc-grpc学习"><a href="#额外参考——rpc-grpc学习" class="headerlink" title="额外参考——rpc,grpc学习"></a>额外参考——rpc,grpc学习</h4><p>左转参考博客</p>
<h4 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h4><ul>
<li><a href="https://www.cnblogs.com/duanxz/p/3769872.html" target="_blank" rel="noopener">rpc介绍</a></li>
<li><a href="https://www.shuzhiduo.com/A/n2d9O7yQJD/" target="_blank" rel="noopener">P4 runtime 和 p4 info</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2021-03-05T08:44:52.946Z" itemprop="dateUpdated">2021-03-05 16:44:52</time>
</span><br>


        
        Link：<a href="/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/" target="_blank" rel="external">http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/</a>
        
    </div>
    
    <footer>
        <a href="http://Tyler-ytr.github.io">
            <img src="/img/Tyler.png" alt="Tyler-yin">
            Tyler-yin
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/p4/" rel="tag">p4</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&title=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&title=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/03/04/STL/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">C++标准库与泛型编程学习笔记</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/03/01/leetcode303-s/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">leetcode303-s</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "NoLhoWnmbSW89zV4zc04RPwx-gzGzoHsz# your leancloud appId",
            appKey: "SSdRGaHcdjoKc7cJJpOlJIqJ",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Tyler-yin &copy; 2015 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&title=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&pic=http://Tyler-ytr.github.io/img/Tyler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&title=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《p4学习-4:P4runtime实验》 — Tyler-yin's blog&url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/&via=http://Tyler-ytr.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tyler-ytr.github.io/2021/03/02/p4%E5%AD%A6%E4%B9%A0-4/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3aSW7DQAwFUd//0gqQraN2fbIdQOzqleBRTwuC0+uFz/V70s+/H/6t1zeODBkyHsu4luedcXd992t3jyP9zIeHIkOGjAMY6yC7DoXkVng4Xn/39nUZMmTIKFHJjfb/V4YMGTJIGseTvH6wliFDxskMkq6RBJGE17RI3lyLy5Ah44GMdDDwn9dfnG/IkCHjIYwrPGn5yoNy665kyJAxmkHKyF3t/nRImT4gGTJkTGXsWoaoBdY060N5qwwZMsYxai2wWgCtteFimAwZMkYzauUoH2SSBHRbY06GDBmDGLVFrtqyV/o7wXqHDBkyRjPSZC5trvEkL12/+OP3ZciQMZSRDinTkUD6LZ6efpjEypAhYxyjlrT1V8o67TkZMmScw+gXljxBrA01SWIqQ4aMExj9VTASjnn4bo05ZciQMY7BS8ddTbcOMshwZciQMYiRBkqSFJJhAA/xwSKIDBkyDmCQa5KopaE5Xqq4+xcZMmQcxkib9bxi7r+CGm0yZMgYxKildKSVv2uRgoRyGTJknMDotO+LixE4DUXjUhkyZIxm7FqY4OPPWpMOhX4ZMmQMZVzh4TdaC6nFd2XIkDGawU86EkgfQZoypqW1DBkyns7gAwBS6PIymDfs0AhBhgwZBzDSEpSveaUDy+JKmQwZMmQsP8MBPFjHRbUMGTJkbA2UpJUWD1ZlyJBxAKNfiKbjhLhMXd+JDBkyRjNamxphKpmONtPQLEOGjHGMH+m3YL4Sox6pAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '＞﹏＜';
            clearTimeout(titleTime);
        } else {
            document.title = '~\(≧▽≦)/~';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>


<script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"superSample":2,"width":125,"height":125,"position":"left","hOffset":30,"vOffset":-20},"mobile":{"show":false,"scale":0.05},"react":{"opacityDefault":1,"opacityOnHover":0.2},"log":false});</script></body>
</html>
